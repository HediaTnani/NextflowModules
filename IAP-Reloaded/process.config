params {
  fastqc_mem = '1G'
  bwa_mem = '12G'
  markdup_mem = '10G'
  splitintervals_mem = '6G'
  bqsrtable_mem = '14G'
  gatherbqsrtables_mem = '6G'
  bqsr_mem = '20G'
  haplotypecaller_mem = '20G'
  mergevcf_mem = '34G'
  combinegvcfs_mem = '34G'
  genotypegvcfs_mem = '34G'
  multiqc_mem = '6G'
  collectmultiplemetrics_mem = '24G'
  collectwgsmetrics_mem = '20G'
  selectvariants_mem = '10G'
  variantfiltration_mem = '10G'
  mergebams_mem = '10G'
  snpeff_mem = '20G'
}


process {
    errorStrategy = 'retry'
    maxRetries = 1

    /* GENERIC TOOL SETTINGS */
    withLabel : 'GATK_4_1_3_0' {
      container = '/hpc/cog_bioinf/cuppen/personal_data/sander/scripts/Nextflow/Singularity-images/gatk4.1.3.0.squashfs'
      time = '24h'
      memory = '34G'
    }
    withLabel : 'SNPEFF_4_3t' {
      container = '/hpc/cog_bioinf/cuppen/personal_data/sander/scripts/Nextflow/Singularity-images/snpeff-4.3t.squashfs'
      time = '24h'
      memory = '34G'
    }

    /* PROCESS SPECIFIC SETTING */
    withLabel : BWA_mem_0_7_17 {
      params.bwa.mem = '12G'
      params.bwa.toolOptions = '-M -c 100'
      container = '/hpc/cog_bioinf/cuppen/personal_data/sander/scripts/Nextflow/Singularity-images/bwa-0.7.17_samtools-1.9.squashfs'
      cpus = 12
      penv = 'threaded'
      memory = params.bwa.mem
      time = '8h'
    }

    withLabel : FASTQC_0_11_8 {
      params.fastqc.mem = '1G'
      params.fastqc.toolOptions = '--noextract'
      container = '/hpc/cog_bioinf/cuppen/personal_data/sander/scripts/Nextflow/Singularity-images/fastqc-0.11.5.squashfs'
      memory = params.fastqc.mem
      time = '2h'
      publishDir.path = "${params.out_dir}/QC"
      publishDir.mode = 'copy'
    }

    withLabel : GATK_baserecalibrator_4_1_3_0 {
      params.baserecalibrator.mem = '14G'
      params.baserecalibrator.toolOptions = ''
      memory = params.baserecalibrator.mem
      time = '4h'
    }

    withLabel : GATK_gatherbaserecalibrator_4_1_3_0 {
      params.gatherbaserecalibrator.mem = '6G'
      memory = params.gatherbaserecalibrator.mem
      time = '4h'
    }

    withLabel : GATK_applybqsr_4_1_3_0 {
      params.applybqsr.mem = '20G'
      memory = params.applybqsr.mem
      time = '4h'
      //publishDir.path = "${params.out_dir}/BAMS"
      //publishDir.mode = 'copy'

    }
    withLabel: GATK_splitintervals_4_1_3_0{
      params.splitintervals.mem = '6G'
      params.splitintervals.toolOptions = ''
      memory = params.splitintervals.mem
      time = '1h'
    }

    withLabel : GATK_haplotypecaller_4_1_3_0 {
      params.haplotypecaller.mem = '20G'
      params.splitintervals.toolOptions = '-ERC GVCF'
      memory = params.haplotypecaller.mem
      time = '12h'
    }

    withLabel : GATK_combinegvcfs_4_1_3_0 {
      params.combinegvcfs.mem = '34G'
      params.splitintervals.toolOptions = ''
      memory = params.combinegvcfs.mem
      time = '12h'
    }

    witLabel : GATK_mergevcfs_4_1_3_0 {
      params.mergevcf.mem = '34G'
      params.mergevcfs.toolOptions = ''
      memory = params.mergevcf.mem
      time = '4h'
      publishDir.path = "${params.out_dir}/VCFS"
      publishDir.mode = 'copy'
    }

    withLabel : GATK_genotypegvcfs_4_1_3_0 {
      params.genotypegvcfs.mem = '34G'
      params.genotypegvcfs.toolOptions = ''
      memory = params.genotypegvcfs.mem
      time = '8h'
    }

    withLabel : GATK_selectvariants_4_1_3_0 {
      params.selectvariants.mem = '10G'
      params.selectvariants.toolOptions = ''
      memory = params.selectvariants.mem
      time = '4h'
    }

    withLabel : GATK_variantfiltration_4_1_3_0 {
      params.variantfiltration.mem = '10G'
      params.selectvariants.toolOptions = ''
      memory = params.variantfiltration.mem
      time = '4h'
    }

    withLabel : GATK_variantannotator_4_1_3_0 {
      params.variantannotator.mem = '20G'
      params.variantannotator.toolOptions = ''
      memory = params.variantannotator.mem
      time = '4h'
    }

    withLabel : GATK_collectmultiplemetrics_4_1_3_0 {
      params.collectmultiplemetrics.mem = '24G'
      params.collectmultiplemetrics.toolOptions = '--PROGRAM CollectAlignmentSummaryMetrics --PROGRAM CollectInsertSizeMetrics --PROGRAM QualityScoreDistribution --PROGRAM MeanQualityByCycle --PROGRAM CollectBaseDistributionByCycle --PROGRAM CollectGcBiasMetrics --PROGRAM CollectSequencingArtifactMetrics --PROGRAM CollectQualityYieldMetrics'
      memory = params.collectmultiplemetrics.mem
      time = '8h'
      publishDir.path = "${params.out_dir}/QC"
      publishDir.mode = 'copy'
    }

    withLabel : GATK_collectwgsmetrics_4_1_3_0 {
      params.collectwgsmetrics.mem = '20G'
      params.collectwgsmetrics.toolOptions = ''
      memory = params.collectwgsmetrics.mem
      time = '8h'
      publishDir.path = "${params.out_dir}/QC"
      publishDir.mode = 'copy'
    }


    withLabel : MULTIQC_1_5 {
      params.multiqc.mem = '6G'
      params.multiqc.toolOptions = '--interactive'
      memory = params.multiqc.mem
      container = '/hpc/cog_bioinf/cuppen/personal_data/sander/scripts/Nextflow/Singularity-images/multiqc-1.5.squashfs'
      time = '2h'
      publishDir.path = "${params.out_dir}/QC"
      publishDir.mode = 'copy'
    }

    withLabel : SAMBAMBA_markdup_0_6_8 {
      params.markdup.mem = '10G'
      params.markdup.toolOptions = '--overflow-list-size=2000000'
      container = '/hpc/cog_bioinf/cuppen/personal_data/sander/scripts/Nextflow/Singularity-images/sambamba-0.6.8.squashfs'
      cpus = 10
      penv = 'threaded'
      memory = params.markdup.mem
      time = '4h'
    }

    withLabel : SAMBAMBA_mergebams_0_6_8 {
      params.mergebams.mem = '10G'
      params.mergebams.toolOptions = ''
      container = '/hpc/cog_bioinf/cuppen/personal_data/sander/scripts/Nextflow/Singularity-images/sambamba-0.6.8.squashfs'
      cpus = 10
      penv = 'threaded'
      memory = params.mergebams.mem
      time = '4h'
      publishDir.path = "${params.out_dir}/BAMS"
      publishDir.mode = 'copy'
    }

    withLabel : SNPEFF_snpefffilter_4_3t {
      params.snpefffilter.mem = '20G'
      params.snpefffilter.toolOptions = 'GRCh37.75 -hgvs -lof -no-downstream -no-upstream -no-intergenic'
      memory = params.snpefffilter.mem
      time = '4h'
    }

    withLabel : SNPEFF_snpsiftsbnsfp_4_3t {
      params.snpsiftsbnsfp.mem = '20G'
      params.snpsiftsbnsfp.toolOptions = '-f hg38_chr,hg38_pos,genename,Uniprot_acc,Uniprot_id,Uniprot_aapos,Interpro_domain,cds_strand,refcodon,SLR_test_statistic,codonpos,fold-degenerate,Ancestral_allele,Ensembl_geneid,Ensembl_transcriptid,aapos,aapos_SIFT,aapos_FATHMM,SIFT_score,SIFT_converted_rankscore,SIFT_pred,Polyphen2_HDIV_score,Polyphen2_HDIV_rankscore,Polyphen2_HDIV_pred,Polyphen2_HVAR_score,Polyphen2_HVAR_rankscore,Polyphen2_HVAR_pred,LRT_score,LRT_converted_rankscore,LRT_pred,MutationTaster_score,MutationTaster_converted_rankscore,MutationTaster_pred,MutationAssessor_score,MutationAssessor_rankscore,MutationAssessor_pred,FATHMM_score,FATHMM_rankscore,FATHMM_pred,MetaSVM_score,MetaSVM_rankscore,MetaSVM_pred,MetaLR_score,MetaLR_rankscore,MetaLR_pred,Reliability_index,VEST3_score,VEST3_rankscore,PROVEAN_score,PROVEAN_converted_rankscore,PROVEAN_pred,CADD_raw,CADD_raw_rankscore,CADD_phred,GERP++_NR,GERP++_RS,GERP++_RS_rankscore,phyloP46way_primate,phyloP46way_primate_rankscore,phyloP46way_placental,phyloP46way_placental_rankscore,phyloP100way_vertebrate,phyloP100way_vertebrate_rankscore,phastCons46way_primate,phastCons46way_primate_rankscore,phastCons46way_placental,phastCons46way_placental_rankscore,phastCons100way_vertebrate,phastCons100way_vertebrate_rankscore,SiPhy_29way_pi,SiPhy_29way_logOdds,SiPhy_29way_logOdds_rankscore,LRT_Omega,UniSNP_ids,1000Gp1_AC,1000Gp1_AF,1000Gp1_AFR_AC,1000Gp1_AFR_AF,1000Gp1_EUR_AC,1000Gp1_EUR_AF,1000Gp1_AMR_AC,1000Gp1_AMR_AF,1000Gp1_ASN_AC,1000Gp1_ASN_AF,ESP6500_AA_AF,ESP6500_EA_AF,ARIC5606_AA_AC,ARIC5606_AA_AF,ARIC5606_EA_AC,ARIC5606_EA_AF,ExAC_AC,ExAC_AF,ExAC_Adj_AC,ExAC_Adj_AF,ExAC_AFR_AC,ExAC_AFR_AF,ExAC_AMR_AC,ExAC_AMR_AF,ExAC_EAS_AC,ExAC_EAS_AF,ExAC_FIN_AC,ExAC_FIN_AF,ExAC_NFE_AC,ExAC_NFE_AF,ExAC_SAS_AC,ExAC_SAS_AF,clinvar_rs,clinvar_clnsig,clinvar_trait,COSMIC_ID,COSMIC_CNT'
      memory =   params.snpsiftsbnsfp.mem
      time = '4h'
    }

    withLabel : SNPEFF_snpsiftannotate_4_3t {
      params.snpsiftannotate.mem = '20G'
      params.snpsiftannotate.toolOptions = '-tabix -name GoNLv5 -info AF,AN,AC'
      memory = params.snpsiftannotate.mem
      time = '12h'
      publishDir.path = "${params.out_dir}/VCFS"
      publishDir.mode = 'copy'
    }
}
